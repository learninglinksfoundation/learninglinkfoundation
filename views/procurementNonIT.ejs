<head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
       <!--  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" /> -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>  
</head>
<style>
  #formdata .form-control {
    width: auto;
    } 
    @media (max-width: 768px){
  .mb-mobile{margin-bottom: 10px;}
  }
  #item_table td {
    vertical-align: middle;
  }
  </style> 

<% include ./partials/messages %>
<% include ./partials/navbar %>
<% include ./partials/footer %>   
    
    
<div class="container-fluid">
</br>
  <div class="col-md-5">
        <a class="btn btn-primary btn-md bg-gray mb-mobile" href="/procurement/assetRequisitionViewRel/<%= parentAssetId %>&<%= isDisabled %>" >Go To Procurement Form </a>
        <a class="btn btn-primary btn-md bg-gray mb-mobile" href="/procurement/getNonItProcurementListVIew/<%= parentAssetId %>&<%= isDisabled %>" >Go To Purchase Information</a>
      </div>
      <br />
  <h3 align="center">Purchase Information</h3>
  <br />
  <div class="">
 <div id="errorMessages"></div>
       <form method="post" action="/insertprecash" id="formdata"  enctype="multipart/form-data">
        <div class="table-responsive" style="overflow-y:auto">
      
         <table class="table table-bordered" id="item_table">
          <tr>
            <th>SR. NO</th>
            <th>Geographic Zone <span style="color: red;">*</span></th>
            <th>STATE <span style="color: red;">*</span></th>
            <th>DISTRICTS - UPPER ZONE  <span style="color: red;">*</span></th>
            <th>DISTRICTS - LOWER ZONE <span style="color: red;">*</span></th>
            <th>CATEGORY <span style="color: red;">*</span></th>
            <th>ITEM CATEGORY <span style="color: red;">*</span></th>
            <th>ITEMS <span style="color: red;">*</span></th>
            <th>OTHER ITEMS</th>
            <th>VENDOR PICKLIST <span style="color: red;">*</span></th>
            <th>COST PER UNIT ITEM</th>
            <th>UNIT</th>
            <th>VENDOR GST NUMBER</th>
            <th>ITEMS SPECIFICATION <span style="color: red;">*</span></th>
            <th>QUANTITY <span style="color: red;">*</span></th>
            <th>TOTAL AMOUNT AS PER PREFERRED VENDOR <span style="color: red;">*</span></th>
            <th>APPROVED BUDGET FOR PURCHASE <span style="color: red;">*</span></th>
            <th>PREVIEW </th>
            <th>ATTACH QUOTE1</th>
            <th>ATTACH QUOTE2</th>
            <th>ATTACH QUOTE3</th>
            <th>QUOTE COUNT</th>
           <th>JUSTIFICATION</th> 
            

            
           <th><button type="button" style="background-color:#2C3E50;" name="add" class="btn btn-success btn-sm add">Add Row</button></th>
           <th style="display:none;"></th>
           <th style="display:none;"></th>
          </tr>
         </table>
         <div align="center">
        
          <input type="submit" style="background-color:#2C3E50; align-content: center ;" id="submitButton" name="submit" class="btn btn-info" value="Submit" />
         </div>
         <br>
         </div>
         
       </form>
       </div>
      </div>

    
    
    <script>

    var itemsCategory = [ "Electrical", "Events", "Materials On Rent", "Miscellaneous","Printing","Stationery" ];
    var Stationery = ["None","A4 Size Paper Rim","Books","Eraser","Files","Magnetic Board","Markers", "Others", "Pen", "Pencil","Sharpner","White", ];
    var Printing = ["None","Binding","Brochures","Caps", "Certificates", "Leaflets","Others", "Posters", "Standees" ];
    var Electrical = ["None","Battery", "Camera", "Extension Board", "Fan" , "Heater", "Inverter", "LCD Projector", "Lights", "Others", "Plasma", "Telephone", "UPS"  ];
    var Events = ["None","Others", "Suggest Hotels"];
    var MaterialsOnRent = ["None", "AV Systems", "Backdrop", "Hardware Peripherals", "Others" , "Projector"];
    var Miscellaneous = ["None","Any Other Expense", "Maintenance"];
    var IT = ['Select','Cartridge','CPU','Desktop','Desktop Mouse','External Hard Disk','Keyboard','Laptop','Laptop Charger','Monitor','Others','Pen Drive','Printer','RAM','Server','Software','Tablet'];    
    

    let Upper_Zone = ['Arunachal Pradesh','Assam','Bihar','Chandigarh','Delhi','Gujarat','Haryana','Himachal Pradesh','Jammu and Kashmir','Jharkhand','Ladakh','Madhya Pradesh','Manipur','Meghalaya','Mizoram','Nagaland','Punjab','Rajasthan','Sikkim','Tripura','Uttarakhand','Uttar Pradesh','Online/PAN India'].sort();
    let Lower_Zone = ['Andaman and Nicobar Islands','Andhra Pradesh','Chhattisgarh','Dadra and Nagar Haveli and Daman and Diu','Goa','Karnataka','Kerala','Lakshadweep','Maharashtra','Odisha','Puducherry','Tamil Nadu','Telangana','West Bengal'].sort();

    let Andaman_and_Nicobar_Islands=["Nicobar","North Middle Andaman","South Andaman"]
    let Andhra_Pradesh=["Anantapur","Chittoor","East Godavari","Guntur","Kadapa","Krishna","Kurnool","Nellore","Prakasam","Srikakulam","Visakhapatnam","Vizianagaram","West Godavari"]
    let Arunachal_Pradesh=["Anjaw","Central Siang","Changlang","Dibang Valley","East Kameng","East Siang","Kamle","Kurung Kumey","Lepa Rada","Lohit","Longding","Lower Dibang Valley","Lower Siang","Lower Subansiri","Namsai","Pakke Kessang","Papum Pare","Shi Yomi","Tawang","Tirap","Upper Siang","Upper Subansiri","West Kameng","West Siang"];
    let Assam=["Bajali","Baksa","Barpeta","Biswanath","Bongaigaon","Cachar","Charaideo","Chirang","Darrang","Dhemaji","Dhubri","Dibrugarh","Dima Hasao","Goalpara","Golaghat","Hailakandi","Hojai","Jorhat","Kamrup","Kamrup Metropolitan","Karbi Anglong","Karimganj","Kokrajhar","Lakhimpur","Majuli","Morigaon","Nagaon","Nalbari","Sivasagar","Sonitpur","South Salmara-Mankachar","Tinsukia","Udalguri","West Karbi Anglong"];
    let Bihar=["Araria","Arwal","Aurangabad","Banka","Begusarai","Bhagalpur","Bhojpur","Buxar","Darbhanga","East Champaran","Gaya","Gopalganj","Jamui","Jehanabad","Kaimur","Katihar","Khagaria","Kishanganj","Lakhisarai","Madhepura","Madhubani","Munger","Muzaffarpur","Nalanda","Nawada","Patna","Purnia","Rohtas","Saharsa","Samastipur","Saran","Sheikhpura","Sheohar","Sitamarhi","Siwan","Supaul","Vaishali","West Champaran"];
    let Chandigarh=["Chandigarh"];
    let Chhattisgarh=["Balod","Baloda Bazar","Balrampur","Bastar","Bemetara","Bijapur","Bilaspur","Dantewada","Dhamtari","Durg","Gariaband","Gaurela Pendra Marwahi","Janjgir Champa","Jashpur","Kabirdham","Kanker","Kondagaon","Korba","Koriya","Mahasamund","Mungeli","Narayanpur","Raigarh","Raipur","Rajnandgaon","Sukma","Surajpur","Surguja"];
    let Dadra_and_Nagar_Haveli_and_Daman_and_Diu=["Dadra Nagar Haveli","Daman","Diu"];
    //let dstrDD=["Daman","Diu"];
    let Delhi=["Central Delhi","East Delhi","New Delhi","North Delhi","North East Delhi","North West Delhi","Shahdara","South Delhi","South East Delhi","South West Delhi","West Delhi"];
    let Goa=["North Goa","South Goa"];
    let Gujarat=["Ahmedabad","Amreli","Anand","Aravalli","Banaskantha","Bharuch","Bhavnagar","Botad","Chhota Udaipur","Dahod","Dang","Devbhoomi Dwarka","Gandhinagar","Gir Somnath","Jamnagar","Junagadh","Kheda","Kutch","Mahisagar","Mehsana","Morbi","Narmada","Navsari","Panchmahal","Patan","Porbandar","Rajkot","Sabarkantha","Surat","Surendranagar","Tapi","Vadodara","Valsad"];
    let Haryana=["Ambala","Bhiwani","Charkhi Dadri","Faridabad","Fatehabad","Gurugram","Hisar","Jhajjar","Jind","Kaithal","Karnal","Kurukshetra","Mahendragarh","Mewat","Palwal","Panchkula","Panipat","Rewari","Rohtak","Sirsa","Sonipat","Yamunanagar",]
    let Himachal_Pradesh=["Bilaspur","Chamba","Hamirpur","Kangra","Kinnaur","Kullu","Lahaul Spiti","Mandi","Shimla","Sirmaur","Solan","Una"];
    let Jammu_and_Kashmir=["Anantnag","Bandipora","Baramulla","Budgam","Doda","Ganderbal","Jammu","Kathua","Kishtwar","Kulgam","Kupwara","Poonch","Pulwama","Rajouri","Ramban","Reasi","Samba","Shopian","Srinagar","Udhampur"]
    let Jharkhand=["Bokaro","Chatra","Deoghar","Dhanbad","Dumka","East Singhbhum","Garhwa","Giridih","Godda","Gumla","Hazaribagh","Jamtara","Khunti","Koderma","Latehar","Lohardaga","Pakur","Palamu","Ramgarh","Ranchi","Sahebganj","Seraikela Kharsawan","Simdega","West Singhbhum"]
    let Karnataka=["Bagalkot","Bangalore Rural","Bangalore Urban","Belgaum","Bellary","Bidar","Chamarajanagar","Chikkaballapur","Chikkamagaluru","Chitradurga","Dakshina Kannada","Davanagere","Dharwad","Gadag","Gulbarga","Hassan","Haveri","Kodagu","Kolar","Koppal","Mandya","Mysore","Raichur","Ramanagara","Shimoga","Tumkur","Udupi","Uttara Kannada","Vijayapura","Yadgir"];
    let Kerala=["Alappuzha","Ernakulam","Idukki","Kannur","Kasaragod","Kollam","Kottayam","Kozhikode","Malappuram","Palakkad","Pathanamthitta","Thiruvananthapuram","Thrissur","Wayanad"];
    let Lakshadweep=["Lakshadweep"];
    let Ladakh=["Kargil","Leh"];
    let Madhya_Pradesh=["Agar Malwa","Alirajpur","Anuppur","Ashoknagar","Balaghat","Barwani","Betul","Bhind","Bhopal","Burhanpur","Chachaura","Chhatarpur","Chhindwara","Damoh","Datia","Dewas","Dhar","Dindori","Guna","Gwalior","Harda","Hoshangabad","Indore","Jabalpur","Jhabua","Katni","Khandwa","Khargone","Maihar","Mandla","Mandsaur","Morena","Narsinghpur","Nagda","Neemuch","Niwari","Panna","Raisen","Rajgarh","Ratlam","Rewa","Sagar","Satna","Sehore","Seoni","Shahdol","Shajapur","Sheopur","Shivpuri","Sidhi","Singrauli","Tikamgarh","Ujjain","Umaria","Vidisha"];
    let Maharashtra=["Ahmednagar","Akola","Amravati","Aurangabad","Beed","Bhandara","Buldhana","Chandrapur","Dhule","Gadchiroli","Gondia","Hingoli","Jalgaon","Jalna","Kolhapur","Latur","Mumbai City","Mumbai Suburban","Nagpur","Nanded","Nandurbar","Nashik","Osmanabad","Palghar","Parbhani","Pune","Raigad","Ratnagiri","Sangli","Satara","Sindhudurg","Solapur","Thane","Wardha","Washim","Yavatmal"];
    let Manipur=["Bishnupur","Chandel","Churachandpur","Imphal East","Imphal West","Jiribam","Kakching","Kamjong","Kangpokpi","Noney","Pherzawl","Senapati","Tamenglong","Tengnoupal","Thoubal","Ukhrul"];
    let Meghalaya=["East Garo Hills","East Jaintia Hills","East Khasi Hills","North Garo Hills","Ri Bhoi","South Garo Hills","South West Garo Hills","South West Khasi Hills","West Garo Hills","West Jaintia Hills","West Khasi Hills"];
    let Mizoram=["Aizawl","Champhai","Hnahthial","Kolasib","Khawzawl","Lawngtlai","Lunglei","Mamit","Saiha","Serchhip","Saitual"];
    let Nagaland=["Mon","Dimapur","Kiphire","Kohima","Longleng","Mokokchung","Noklak","Peren","Phek","Tuensang","Wokha","Zunheboto"];
    let Odisha=["Angul","Balangir","Balasore","Bargarh","Bhadrak","Boudh","Cuttack","Debagarh","Dhenkanal","Gajapati","Ganjam","Jagatsinghpur","Jajpur","Jharsuguda","Kalahandi","Kandhamal","Kendrapara","Kendujhar","Khordha","Koraput","Malkangiri","Mayurbhanj","Nabarangpur","Nayagarh","Nuapada","Puri","Rayagada","Sambalpur","Subarnapur","Sundergarh"];
    let Puducherry=["Karaikal","Mahe","Puducherry","Yanam"];
    let Punjab=["Amritsar","Barnala","Bathinda","Faridkot","Fatehgarh Sahib","Fazilka","Firozpur","Gurdaspur","Hoshiarpur","Jalandhar","Kapurthala","Ludhiana","Mansa","Moga","Mohali","Muktsar","Pathankot","Patiala","Rupnagar","Sangrur","Shaheed Bhagat Singh Nagar","Tarn Taran"];
    let Rajasthan=["Ajmer","Alwar","Banswara","Baran","Barmer","Bharatpur","Bhilwara","Bikaner","Bundi","Chittorgarh","Churu","Dausa","Dholpur","Dungarpur","Hanumangarh","Jaipur","Jaisalmer","Jalore","Jhalawar","Jhunjhunu","Jodhpur","Karauli","Kota","Nagaur","Pali","Pratapgarh","Rajsamand","Sawai Madhopur","Sikar","Sirohi","Sri Ganganagar","Tonk","Udaipur"];
    let Sikkim=["East Sikkim","North Sikkim","South Sikkim","West Sikkim"];
    let Tamil_Nadu=["Ariyalur","Chengalpattu","Chennai","Coimbatore","Cuddalore","Dharmapuri","Dindigul","Erode","Kallakurichi","Kanchipuram","Kanyakumari","Karur","Krishnagiri","Madurai","Mayiladuthurai","Nagapattinam","Namakkal","Nilgiris","Perambalur","Pudukkottai","Ramanathapuram","Ranipet","Salem","Sivaganga","Tenkasi","Thanjavur","Theni","Thoothukudi","Tiruchirappalli","Tirunelveli","Tirupattur","Tiruppur","Tiruvallur","Tiruvannamalai","Tiruvarur","Vellore","Viluppuram","Virudhunagar"];
    let Telangana=["Adilabad","Bhadradri Kothagudem","Hyderabad","Jagtial","Jangaon","Jayashankar","Jogulamba","Kamareddy","Karimnagar","Khammam","Komaram Bheem","Mahabubabad","Mahbubnagar","Mancherial","Medak","Medchal","Mulugu","Nagarkurnool","Nalgonda","Narayanpet","Nirmal","Nizamabad","Peddapalli","Rajanna Sircilla","Ranga Reddy","Sangareddy","Siddipet","Suryapet","Vikarabad","Wanaparthy","Warangal Rural","Warangal Urban","Yadadri Bhuvanagiri"];
    let Tripura=["Dhalai","Gomati","Khowai","North Tripura","Sepahijala","South Tripura","Unakoti","West Tripura"];
    let Uttar_Pradesh=["Agra","Aligarh","Ambedkar Nagar","Amethi","Amroha","Auraiya","Ayodhya","Azamgarh","Baghpat","Bahraich","Ballia","Balrampur","Banda","Barabanki","Bareilly","Basti","Bhadohi","Bijnor","Budaun","Bulandshahr","Chandauli","Chitrakoot","Deoria","Etah","Etawah","Farrukhabad","Fatehpur","Firozabad","Gautam Buddha Nagar","Ghaziabad","Ghazipur","Gonda","Gorakhpur","Hamirpur","Hapur","Hardoi","Hathras","Jalaun","Jaunpur","Jhansi","Kannauj","Kanpur Dehat","Kanpur Nagar","Kasganj","Kaushambi","Kheri","Kushinagar","Lalitpur","Lucknow","Maharajganj","Mahoba","Mainpuri","Mathura","Mau","Meerut","Mirzapur","Moradabad","Muzaffarnagar","Pilibhit","Pratapgarh","Prayagraj","Raebareli","Rampur","Saharanpur","Sambhal","Sant Kabir Nagar","Shahjahanpur","Shamli","Shravasti","Siddharthnagar","Sitapur","Sonbhadra","Sultanpur","Unnao","Varanasi"];
    let Uttarakhand=["Almora","Bageshwar","Chamoli","Champawat","Dehradun","Haridwar","Nainital","Pauri","Pithoragarh","Rudraprayag","Tehri","Udham Singh Nagar","Uttarkashi"];
    let West_Bengal=["Alipurduar","Bankura","Birbhum","Cooch Behar","Dakshin Dinajpur","Darjeeling","Hooghly","Howrah","Jalpaiguri","Jhargram","Kalimpong","Kolkata","Malda","Murshidabad","Nadia","North 24 Parganas","Paschim Bardhaman","Paschim Medinipur","Purba Bardhaman","Purba Medinipur","Purulia","South 24 Parganas","Uttar Dinajpur"];

    var onlinePan = ['Online/PAN India'];


    var subListValue="";
    var sts='';
    var dstr='';
    let objCollection = {};
    objCollection.it = [{key:'Select',value:''},{key:'IT',value:'IT'}];
    objCollection.nonIt = [{key:'Select',value:''}];
    itemsCategory.forEach(dt=>{
      objCollection.nonIt.push({key:dt,value:dt.split(' ').join('')});
    });


    function clearData(data,i){
      data.forEach(dt=>{
        $(`#${dt}${i}`).val('');
        //$(`#${dt}${i}`).html('');
      });
    }

    $(document).ready(function(){
     var count = 1
     var lstObjects = [];
     $(document).on('click', '.add', function(){
        var cnt = count++;
        qt=0;
        var html = '';
        html += '<tr>';
        html += '<td>'+cnt+'</td>';
        html += '<td><select id="zone'+cnt+'"  name="zone" class="form-control item_unit"><option value="">Select</option><option value="Upper Zone">Upper Zone</option><option value="Lower Zone">Lower Zone</option></select></td>';
        html += '<td><select id="state'+cnt+'" style="width: 200px;" name="state" disabled class="form-control item_unit"><option value="">Select</option></select></td>';

        html += '<td><select id="districtUpper'+cnt+'" style="width: 200px;" readonly name="districtUpper" multiple class="form-control item_unit" ></select></td>';
        html += '<td><select id="districtLower'+cnt+'" style="width: 200px;" readonly name="districtLower" multiple class="form-control item_unit" ></select></td>';
        
        html += '<td><select name="category" id="category'+cnt+'" class="form-control item_unit "><option value="">Select</option><option value="NonIT">Non-IT</option><option value="IT">IT</option></select></td>';
        html += '<td><select name="itemsCategory" disabled style="width: 170px;" id="cat'+cnt+'" class="form-control item_unit itemsCategory"><option value="">Select</option></select></td>';
        html += '<td><select name="items" id="'+cnt+'" class="form-control item_unit items"><option value="">Select</option></select></td>';
        html += '<td><select name="otherItems" id="other'+cnt+'" readonly="true" class="form-control" ><option value="" >Select</option>  <select></td>';
        html += '<td><select id="vendor'+cnt+'" name="vendor" class="form-control item_unit"><option value="">Select</option></select></td>';    
        html +='<td><input id="unitCost'+cnt+'" type="text" name="unitCost" class="form-control" readonly="true"  /></td>';
        html +='<td><input id="unit'+cnt+'" type="text" name="unit" class="form-control" readonly="true"  /></td>';  
        html +='<td><input id="gst'+cnt+'" type="text" name="gst" class="form-control" readonly="true"  /></td>';
        html += '<td><input type="text" id="itemSpecification'+cnt+'"  name="itemSpecification" class="form-control" /></td>';
        html += '<td><input type="number" id="quantity'+cnt+'" name="quantity" class="form-control" /></td>';
        html += '<td><input type="number" id="budget'+cnt+'" name="budget" class="form-control" /></td>';
        html += '<td><input type="number" id="totalApproved'+cnt+'" name="totalApproved" class="form-control" /></td>';
        html += '<td><a id="quote'+cnt+'" target="_blank" href="#" >No Quotes Available</a></td>';
        html += '<td><input type="file" onChange="chkFile1(this,'+cnt+')" name="fileprety" id="fileprety" style="overflow:hidden" class="form-control" /><input type="hidden" value="demo1" name="imgpath1" id="file_1'+cnt+'"></td>';
        html += '<td><input type="file" onChange="chkFile2(this,'+cnt+')" name="fileprety" id="fileprety"  style="overflow:hidden" class="form-control" /><input type="hidden" value="demo2" name="imgpath2" id="file_2'+cnt+'"></td>';
        html += '<td><input type="file" onChange="chkFile3(this,'+cnt+')" name="fileprety" id="fileprety"  style="overflow:hidden" class="form-control" /><input type="hidden" value="demo3" name="imgpath3" id="file_3'+cnt+'"></td>';
        html += '<td><input type="number" id="qtNo'+cnt+'" name="quoteNum" class="form-control" value="0" readonly="true" /></td>';
        html += '<td><input type="text" name="justification" id="justification'+cnt+'" class="form-control" /></td>';
        
       // html += '<td style="display:none;"><input type="hidden" id="qt'+cnt+'" name="quoteNum" class="form-control" /></td>';
        //    html += '<td style="display:none;"><input id="impId'+cnt+'" type="hidden" name="impaneledVendorId" value="" class="form-control" /></td>';
        html += '<td style="display:none;"><input  type="hidden" name="parentProcurementId" value="<%= parentAssetId %>" class="form-control" /></td>';
        html += '<td><button type="button" name="remove" class="btn btn-danger btn-sm remove"><span class="glyphicon glyphicon-minus">Delete</span></button></td></tr>';
        
        $('#item_table').append(html);



      $('#state'+cnt).attr('disabled',true);
      $('#zone'+cnt).on('change',function(){
        let val = this.value.replaceAll(' ','_');
        $('#state'+cnt).attr('disabled',!val);
        $('#state'+cnt).find('option').not(':first').remove();
        $('#districtUpper'+cnt +',#districtLower'+cnt).attr('readonly',true);

        let dt = ['districtUpper','districtLower','category','cat','','other','vendor','unitCost','unit','gst','itemSpecification','quantity','budget','totalApproved','justification'];

        clearData(dt,cnt);


        $('#districtUpper'+cnt +',#districtLower'+cnt).html('');
        let states = eval(val);
        for(let i=0; i < states?.length; i++)
        {
          $('#state'+cnt)
          .append($("<option></option>")
          .attr("value",states[i])
          .text(states[i]))
        }


      });



      $('#state'+cnt).on('change',function(){
        let state =this.value.replaceAll(' ','_');
        sts = this.value;
        let Zone = $('#zone'+cnt).val();
        $('#districtUpper'+cnt +',#districtLower'+cnt).attr('readonly',true);
        $('#districtUpper'+cnt +',#districtLower'+cnt).html('');

        let dt = ['category','cat','','other','vendor','unitCost','unit','gst','itemSpecification','quantity','budget','totalApproved','justification'];

        clearData(dt,cnt);

        if(state != 'Online/PAN_India'){
        let list = eval(state);
        if(Zone == 'Upper Zone' && list?.length > 0 ){
          $('#districtUpper'+cnt).attr('readonly',false);
          list.forEach(dt=>{
            $('#districtUpper'+cnt)
           .append($("<option></option>")
           .attr("value",dt)
           .text(dt))

          })

        }
        else if(Zone == 'Lower Zone' && list?.length > 0 ){
          $('#districtLower'+cnt).attr('readonly',false);
          list.forEach(dt=>{
            $('#districtLower'+cnt)
           .append($("<option></option>")
           .attr("value",dt)
           .text(dt))
            
          })
        }
        else{

        }
      }
      else{
        $('#districtUpper'+cnt).attr('readonly',false);
          onlinePan.forEach(dt=>{
            $('#districtUpper'+cnt)
           .append($("<option></option>")
           .attr("value",dt)
           .text(dt))

          })

      } 
                 
     })

     
     


        

        


        $('#category'+cnt).on('change',function(){
          let sel = this.value;
          let dt = ['cat','','other','vendor','unitCost','unit','gst','itemSpecification','quantity','budget','totalApproved','justification'];

           clearData(dt,cnt);
          if(sel == 'NonIT'){
            $('#cat'+cnt).prop('disabled',false);
            $('#cat'+cnt).html('');
            objCollection.nonIt.forEach(dt=>{
              $('#cat'+cnt).append($('<option/>', { 
                value: dt.value,
                text : dt.key 
            }));
          });
            
          }
          else if(sel == 'IT'){
            $('#cat'+cnt).prop('disabled',false);
            $('#cat'+cnt).html('');
            objCollection.it.forEach(dt=>{
              $('#cat'+cnt).append($('<option/>', { 
                value: dt.value,
                text : dt.key 
            }));
          });
          }
          else{
            $('#cat'+cnt).prop('disabled',true);
            $('#cat'+cnt).html('');
            $('#cat'+cnt).append($('<option/>', { 
                value: '',
                text : 'Select'
            }));
          }
          
        });
       


        var lstVendorDetail=[]; let itVal=''; let sid='';
        $('#vendor'+cnt).unbind('change');
        $('#vendor'+cnt).on('change',function(){
         // alert('quoted Ref=>'+lstVendorDetail[0].quote_public_url__c);
         let dt1 = ['itemSpecification','quantity','budget','totalApproved','justification'];
            clearData(dt1,cnt); 
          let sif =this.value;
          $('#unitCost'+cnt).val('');
          $('#unit'+cnt).val('');
          $('#gst'+cnt).val('');
          console.log('sfidSelected = '+sif);
          let gstNo=document.getElementById('gst'+cnt);
          console.log(lstVendorDetail);
          lstVendorDetail.forEach((each)=>{
            console.log(each);
           if(each.sfid==sif){
            gstNo.value=each.gst_no__c;
            sid=each.sfid;
          

           }
          })
          $.ajax({
            url : '/procurement/getCostPerUnit',
            type : 'get',
            data: {sid:sid},
            dataType : 'json'
          })
          .done((response)=>{
            console.log('response '+JSON.stringify(response));
             
            if(response.length>0){

              response.forEach((each)=>{
                 console.log('dd',each);
                if(each.items__c==itVal){
                  let unCost=document.getElementById('unitCost'+cnt);
                  unCost.value=each.per_unit_cost__c;
                  //alert('unit for Item'+each.unit__c);
                  let itemUnit=document.getElementById('unit'+cnt);
                  itemUnit.value=each.unit__c;
                  if(each.public_quote_url__c){
                    $('#quote'+cnt)
                     .attr("href",each.public_quote_url__c)
                     .text('Available Quote'); 
                    }  
                    else{
                      $('#quote'+cnt)
                      .attr("href",each.public_quote_url__c)
                      .text('No Quote Available'); 
                    } 
      
                }
              })
            }
            
          })
          .fail((jqXHR,text,err) => {
            console.log('jqXHR  '+JSON.stringify(jqXHR));
            console.log('err  '+err + 'text  : '+text);
        })
        })




        let itemsCategoryValue, itemValue, placeValue, impaneledVendorId = '';
       
        $('#cat'+cnt).unbind('change');
        $('#cat'+cnt).on('change', function() {
          let dt = ['','other','vendor','unitCost','unit','gst','itemSpecification','quantity','budget','totalApproved','justification'];

              clearData(dt,cnt);
               $('#'+cnt).empty();
               itemsCategoryValue = this.value;
               console.log('itemsCategoryValue',itemsCategoryValue);
               console.log('value',this.value);
               subListValue = eval(this.value);
               console.log(subListValue); 
             //  alert('subListValue  '+subListValue);
               for(i=0;i<subListValue.length;i++)
               {
                
                 $('#'+cnt)
                   .append($("<option></option>")
                   .attr("value",subListValue[i])
                   .text(subListValue[i]));		
              }
              
              $('#'+cnt).unbind('change');
              $('#'+cnt).on('change', function() {
                  itVal=this.value;

                  let zone = $('#zone'+cnt).val();
                  if(zone == 'Upper Zone'){
                    dstr = $('#districtUpper'+cnt).val().join(';');
                  }
                  else if(zone == 'Lower Zone'){
                    dstr = $('#districtLower'+cnt).val().join(';');
                  }
                  else{
                    dstr = '';
                  }
                  
                   itemValue = this.value;
                      var data =[];
                      let filtervalues={};
                          filtervalues.state=sts;
                          filtervalues.district=dstr;
                          
                            filtervalues.item=itemValue;
                       let obj = {};
                       obj.state = sts;
                       obj.dist =  dstr;
                       obj.item=itemValue;
                       obj.category = $('#cat'+cnt).val();  
                          
                          data.push(filtervalues);
                          console.log(JSON.stringify(data));
                      let optList = [{value:'',text:'Select'}];
                      if(itemValue == 'Others'){
                        $('#other'+cnt).attr("readonly",false);
                        $.ajax({
                          url : '/procurement/getOtherItems',
                          type : 'get',
                          data: { data : obj },
                          dataType : 'json'
                        })
                        .done(resp=>{
                          
                          resp.forEach(data=>{
                            optList.push({value:data.others,text:data.others});
                          });
                          drawOptions(optList,cnt);

                          $('#other'+cnt).unbind();
                          $('#other'+cnt).on('change',function(){
                            let value = this.value;
                            let data = {};
                            data.state = $('#state'+cnt).val();
                            data.dist = dstr;
                            data.category = $('#cat'+cnt).val();
                            data.item = $('#'+cnt).val();
                            data.others = value;
                            console.log(data);
                            console.log(dstr);
                            $.ajax({
                                      url : '/procurement/getOtherItemsVendor',
                                      type : 'get',
                                      data: { data:data },
                                      dataType : 'json'
                                    })
                                    .done((response) => {
                                      lstVendorDetail = [];
                                      console.log('Vendor ResultData '+JSON.stringify(response));
                                      console.log('length '+response.length);
                                      console.log('dgsdh ',response);
                                      let select = document.getElementById("vendor"+cnt);
                                      let length = select.options.length;
                                      for (i = length-1; i > 0; i--) {
                                        select.options[i] = null;
                                       }
                                      
                                          $('#unitCost'+cnt).val('');
                                           $('#unit'+cnt).val('');
                                           $('#gst'+cnt).val('');
                                          
                                      
                                        for(let i=0;i<response.length;i++)
                                        {
                                          $('#vendor'+cnt)
                                          .append($("<option></option>")
                                          .attr("value",response[i].sfid)
                                          .text(response[i].vendor_name__c))
                                          lstVendorDetail.push(response[i]);
                                        }

                                        console.log('lstVendorDetail=> ',lstVendorDetail);
                                        
                                    })
                                    .fail((jqXHR,text,err) => {
                                        console.log('jqXHR  '+JSON.stringify(jqXHR));
                                        console.log('err  '+err + 'text  : '+text);
                                    })
                          });

                                                       
                                                })
                                                .fail((jqXHR,text,err) => {
                                                  console.log('jqXHR  '+JSON.stringify(jqXHR));
                                                  console.log('err  '+err + 'text  : '+text);
                        })
                      }
                      else{
                         $('#other'+cnt).attr("readonly",true);
                         drawOptions(optList,cnt);

                         $('#other'+cnt).unbind();
                        $('#other'+cnt).on('change',function(){
                          let value = this.value;
                          let data = {};
                          data.state = $('#state'+cnt).val();
                          data.dist = dstr;
                          data.category = $('#cat'+cnt).val();
                          data.item = $('#'+cnt).val();
                          data.others = value;
                          console.log(data);

                          $.ajax({
                                    url : '/procurement/getOtherItemsVendor',
                                    type : 'get',
                                    data: { data:data },
                                    dataType : 'json'
                                  })
                                  .done((response) => {
                                    lstVendorDetail = [];
                                    console.log('Vendor ResultData '+JSON.stringify(response));
                                    console.log('length '+response.length);
                                    console.log('dgsdh ',response);
                                    let select = document.getElementById("vendor"+cnt);
                                    let length = select.options.length;
                                    for (i = length-1; i > 0; i--) {
                                      select.options[i] = null;
                                     }
                                    
                                        $('#unitCost'+cnt).val('');
                                         $('#unit'+cnt).val('');
                                         $('#gst'+cnt).val('');
                                        
                                    
                                      for(let i=0;i<response.length;i++)
                                      {
                                        $('#vendor'+cnt)
                                        .append($("<option></option>")
                                        .attr("value",response[i].sfid)
                                        .text(response[i].vendor_name__c))
                                        lstVendorDetail.push(response[i]);
                                      }

                                      console.log('lstVendorDetail=> ',lstVendorDetail);
                                      
                                  })
                                  .fail((jqXHR,text,err) => {
                                      console.log('jqXHR  '+JSON.stringify(jqXHR));
                                      console.log('err  '+err + 'text  : '+text);
                                  })
                          });

                      }

                      if(itemValue != 'Others'){
                        $.ajax({
                          url : '/procurement/getCostandGSt',
                          type : 'get',
                          data: { data:data },
                          dataType : 'json'
                        })
                        .done((response) => {
                          lstVendorDetail = [];
                          console.log('Vendor ResultData '+JSON.stringify(response));
                          console.log('length '+response.length);
                          console.log('dgsdh ',response);
                          let select = document.getElementById("vendor"+cnt);
                          let length = select.options.length;
                          for (i = length-1; i > 0; i--) {
                            select.options[i] = null;
                           }
                          
                              $('#unitCost'+cnt).val('');
                               $('#unit'+cnt).val('');
                               $('#gst'+cnt).val('');
                              
                          
                            for(let i=0;i<response.length;i++)
                            {
                              $('#vendor'+cnt)
                              .append($("<option></option>")
                              .attr("value",response[i].sfid)
                              .text(response[i].vendor_name__c))
                              lstVendorDetail.push(response[i]);
                            }

                            console.log('lstVendorDetail=> '+JSON.stringify(lstVendorDetail));
                            
                        })
                        .fail((jqXHR,text,err) => {
                            console.log('jqXHR  '+JSON.stringify(jqXHR));
                            console.log('err  '+err + 'text  : '+text);
                        })
                    }
                  });
        });
      

     });
   
     $(document).on('click', '.remove', function(){
        $(this).closest('tr').remove();
        qt=0;
     });

  });


function drawOptions(optList,cnt){
  let dt1 = ['other','vendor','unitCost','unit','gst','itemSpecification','quantity','budget','totalApproved','justification'];
  clearData(dt1,cnt); 
   let select1 = document.getElementById("vendor"+cnt);
    let length1 = select1.options.length;
    for (i = length1-1; i > 0; i--) {
      select1.options[i] = null;
     }
    $('#other'+cnt).html('');
    optList.forEach(dt=>{
    $('#other'+cnt).append($("<option></option>").attr("value",dt.value).text(dt.text)); 
  });
  
}
    
    
    $(function () {
      $('form#formdata').bind('submit', function () {
        $("#submitButton").attr("disabled", true);
       // alert('qt'+qt);
       console.log($('form#formdata').serialize());
          $.ajax({
            type: 'post',
            url: '/procurement/nonItProducts',   // Need to make changes in post method url
            data:$('form#formdata').serialize(),
            success: function (data) {
              console.log(data);
             // alert(data);
             if(data=='Saved Successfully')
             {
                document.getElementById("formdata").reset();
                $("#submitButton").attr("disabled", false);
                let errorHtml = '<div class="alert alert-success alert-dismissible fade show" role="alert">'+ data+
                '<button type="button" class="close" data-dismiss="alert" aria-label="Close">'+
                '<span aria-hidden="true">&times;</span>'+
                '</button>'+
                 '</div>';
                 $('#errorMessages').empty();
                 $('#errorMessages').append(errorHtml); 

                 window.setTimeout(function(){
                    window.location.reload();
                 },1500);
              }
              else
              {
                  let errorHtml = '<div class="alert alert-danger alert-dismissible fade show" role="alert">'+data+
                  '<button type="button" class="close" data-dismiss="alert" aria-label="Close">'+
                   '<span aria-hidden="true">&times;</span>'+
                    '</button>'+
                    '</div>';
                   $('#errorMessages').empty();
                  $('#errorMessages').append(errorHtml); 
                  $("#submitButton").attr("disabled", false);
                }
           
             
              
            }
          });
   //     var qt1=document.getElementById('file_1'+cnt).value();
        return false;
      });
    });
    function chkFile1(file1,id) {
      var file = file1.files[0];
      var formData = new FormData();
      formData.append('formData', file);  
      $.ajax({
      type: "POST",
      url: "/expense/uploadImage",    
      cache: false,
      dataType:'json',
      processData: false,
      contentType: false,
      data: formData,
      success: function (data) {
        console.log(data);
        $('#file_1'+id).val(data.url);
        let qtHTML=$('#qtNo'+id).val();
        qtHTML++;
        console.log('from upload 1'+qtHTML)
        $('#qtNo'+id).val(qtHTML);
        console.log('qt'+qtHTML);
       if(qtHTML==3)
       {
        $('#justification'+id).attr("readonly",true);
       }
       
       }
    });
  }

  function chkFile2(file1,id) {
    var file = file1.files[0];
    var formData = new FormData();
    formData.append('formData', file);

    $.ajax({
    type: "POST",
    url: "/expense/uploadImage",    
    cache: false,
    dataType:'json',
    processData: false,
    contentType: false,
    data: formData,
    success: function (data) {
      console.log(data);
     $('#file_2'+id).val(data.url);
     let qtHTML=$('#qtNo'+id).val();
     qtHTML++;
     console.log('from upload'+qtHTML)
     $('#qtNo'+id).val(qtHTML);
     console.log('qt'+qtHTML);
     if(qtHTML==3)
     {
      $('#justification'+id).attr("readonly",true);
     }
     }
  });
}
function chkFile3(file1,id) {
  var file = file1.files[0];
  var formData = new FormData();
  formData.append('formData', file);

  $.ajax({
  type: "POST",
  url: "/expense/uploadImage",    
  cache: false,
  dataType:'json',
  processData: false,
  contentType: false,
  data: formData,
  success: function (data) {
    console.log(data);
  //  var result = JSON.stringify(data)
  $('#file_3'+id).val(data.url);
  let qtHTML=$('#qtNo'+id).val();
  qtHTML++;
  console.log('from upload'+qtHTML)
  $('#qtNo'+id).val(qtHTML);
  console.log('qt'+qtHTML);  
   if(qtHTML==3)
   {
    $('#justification'+id).attr("readonly",true);
   }
   }
});
}
    
</script>
