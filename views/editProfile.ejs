<% include ./partials/navbar %>


<style>

.center{
    display: flex;
    justify-content: center;
    align-items: center;
    height: 88vh;
    width: 100%;
}
body{
    padding-bottom: 0;
}
.avtar {height: 70px;
  width: 70px;
  padding: 14px 27px;
  font-size: 1.5rem;
  position: absolute;
  background: #ecf0f1;
  top: -2.8rem;
  border-radius: 100%;
  left: 50%;
  transform: translateX(-50%);
}
.profileImg{
     height: 70px;
    width: 70px;
    border-radius: 100%;
    position: absolute;
    left: 0;
    top: 0;
    right: 0; 
}
.profileImg{
  height: 70px;
 width: 70px;
 border-radius: 100%;
 position: absolute;
 left: 0;
 top: 0;
 right: 0; 
}
  .camIcon {
 left: 50px;
    position: absolute;
    z-index: 5;
    color: #2c3e50;
    bottom: 0;
    background: white; 
  }
</style>


<p id='userDetails'><%=userdetail.sfid %></p>



<div class="center">
  <div class="col-md-6 m-auto">
    <div class="card card-body" style="padding-top:3rem">
      <div class="avtar">K
        <i class="fas fa-camera camIcon" ></i>
        <img src="/image/logo.png" class="profileImg"> 
      </div>
        <% include ./partials/messages %>
        <div id="errorMessages"></div>
      
        <form name="editprofile" id="editprofile"  >
            <div class="form-group">
              <div style="display: flex;
              flex-wrap: wrap;
              justify-content: space-between;">
                  <div class="col-md-6">
                      <label for="nam">Name</label>
                      <input type="text"  class="form-control" id="nam" value= '<%=userdetail.name %>' name="nam" required="true">
                  </div>
              <div class="col-md-6">
                <label for="phn">Email/Username</label>
                <input type="text" disabled class="form-control" id="phn" value='<%=userdetail.email %>'  name="phn" >
              </div>
              <!-- <div class="col-md-6">
                <label for="postal">Postal Code</label>
                <input type="number"  class="form-control" id="postal" value='<%=userdetail.postal_code__c %>' name="postal"  >
              </div>-->
              <div class="col-md-6">
                <label for="empid">Employee ID</label>
                <input type="text"  class="form-control" id="empid" value='<%=userdetail.employee_id__c %>' name="empid"  >
              </div>
              <div class="col-md-6">
                <label for="empCat">Employee Category</label>
                <select name="empCat" id="empCat" class="form-control">
                  <option value="" >Select</option>
                 
                </select>
    
              </div>
              <div class="col-md-6">
                <label for="desig">Designation</label>
                <select name="desig" id="desig" class="form-control">
                  <option value="" >Select</option>
                  
                </select>
     
              </div>
              <div class="col-md-6">
                <label for="mob">Mobile</label>
                <input type="number"  class="form-control" id="mob" value='<%=userdetail.mobilephone %>' name="mob"  >
              </div>
              <div class="col-md-6">
                <label for="repmanage">Reporting manager</label>
                <input type="text"  class="form-control" id="repmanage" disabled value='<%=userdetail.reportingname %>' name="repmanage"  >
              </div>
              </div>
              <div class="col-md-6">
                <input type="hidden"  class="form-control" id="uid" value='<%=userdetail.sfid %>'  name="uid" >
              </div>
            </div>
          <div style="text-align:center"><button type="submit" class="btn btn-primary" id="saveProf" >Save</button></div>
        </form>



      </div>
    </div>
 </div>



<script>
    $(document).ready(function(){
        $('#userDetails').hide();
        let contactId = document.getElementById('userDetails').innerHTML;
        let obj = JSON.parse('<%- JSON.stringify(userdetail) %>')
        let desigobj=JSON.parse('<%- JSON.stringify(userdetail)%>')

        let category = ['Full-Time','Fixed-Term Employment','Retainer'];
        let designation=['Managing Partner','Principal Partner','Senior Partner','Partner','Associate Partner','Managing Consultant','Principal Consultant','Senior Consultant','Lead Consultant','Consultant','Executive','Chairperson','Senior Managing Consultant']

        category.forEach(dt=>{
                $('#empCat').append($("<option></option>")
                .attr("value",dt)
                .text(dt))
        }) 

        designation.forEach(desin=>{ 
            $('#desig').append($("<option></option>")
            .attr("value",desin)
            .text(desin))
        })
        $('#empCat').val(obj.employee_category_band__c)
        $('#desig').val(desigobj.pm_email__c)


        $('#saveProf').on('click',function(event){
            event.preventDefault();
            event.stopPropagation();
            event.stopImmediatePropagation();    
            var $inputs = $('#editprofile :input');
            var values={};
            $inputs.each(function() {
                values[this.name] = $(this).val();
            })
            console.log('FormValues '+JSON.stringify(values));
            $.ajax({
                url : '/users/updateProfile',
                type:'post',
                data: values,
                dataType : 'json'
            })
            .done((response)=>{
                console.log('Profile Updated Succesfuly');
                let successText = 'Profile Updated Succesfuly';
                let errorHtml = '';
                errorHtml += '<div class="alert alert-success alert-dismissible fade show" role="alert">'+
                    successText+
                  '<button type="button" class="close" data-dismiss="alert" aria-label="Close">'+
                    '<span aria-hidden="true">&times;</span>'+
                  '</button>'+
                '</div>';
                $('#errorMessages').empty();
                $('#errorMessages').append(errorHtml);
                 
               // alert('Error in Server Side '+JSON.stringify(response));
            })
            .fail((jqXHR, status, error) => {
                console.log('jqXHR  '+JSON.stringify(jqXHR));

              let errList = ['abcd','xyz', 'pqr'];

              let errorHtml = '';
              errList.forEach((eachError) => {
                errorHtml += '<div class="alert alert-danger alert-dismissible fade show" role="alert">'+
                    eachError+
                    '<button type="button" class="close" data-dismiss="alert" aria-label="Close">'+
                      '<span aria-hidden="true">&times;</span>'+
                    '</button>'+
                  '</div>';
              })


                
                errorHtml += '<div class="alert alert-danger alert-dismissible fade show" role="alert">'+
                  jqXHR.responseText+
                  '<button type="button" class="close" data-dismiss="alert" aria-label="Close">'+
                    '<span aria-hidden="true">&times;</span>'+
                  '</button>'+
                '</div>';
                $('#errorMessages').empty();
                $('#errorMessages').append(errorHtml);
          }) 
          window.location.reload();
          location.replace('https://learninglinksfoundation-test.herokuapp.com/users/login');
      })
     
})
</script>